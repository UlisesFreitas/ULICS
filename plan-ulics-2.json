{
    "projectName": "ULICS Fantasy Console",
    "version": "2.0.0",
    "status": "IN PROGRESS - Post v1.0.0",
    "description": "Development plan for ULICS v1.1, v1.5, and v2.0. Includes bug fixes, IDE tools, and advanced features.",
    "previousPlan": "plan-ulics.json (v1.0.0 - Completed 2025-12-13)",
    "phases": [
        {
            "phase": "1.1",
            "title": "Bug Fixes & Stability",
            "description": "Critical bug fixes from v1.0.0 release. Focus on rendering and audio issues.",
            "priority": "CRITICAL",
            "estimatedTime": "1-2 weeks",
            "tasks": [
                {
                    "id": "1.1.1",
                    "description": "Fix rendering flicker in Pong demo - investigate collision bounce causing visual artifacts.",
                    "status": "completed",
                    "priority": "HIGH",
                    "files": "cartridges/pong/main.lua",
                    "notes": "COMPLETED 2025-12-14. ROOT CAUSE: Same floating point issue as platformer (1.1.2). Ball/paddle coordinates accumulated decimals causing 'number has no integer representation' error, which froze rendering. FIX: Use flr() on all coordinates before passing to rectfill(). No actual 'flicker' - it was crash-freeze due to unhandled floating point values."
                },
                {
                    "id": "1.1.2",
                    "description": "Fix Platformer player disappearing bug - player sprite vanishes when moving.",
                    "status": "completed",
                    "priority": "HIGH",
                    "files": "cartridges/platformer/main.lua, src/scripting/ScriptingManager.cpp",
                    "notes": "COMPLETED 2025-12-13. ROOT CAUSE: Floating point coordinates! px/py accumulated fractional values from friction (pvx*0.7) causing 'number has no integer representation' error in rectfill(). FIX: Use flr() to floor coordinates before rendering. Also enhanced Lua error reporting with stack traces for easier debugging. Menu selector also fixed (rectfill API clarification)."
                },
                {
                    "id": "1.1.3",
                    "description": "Fix audio threading issue - audio callback causes 6-8s input lag.",
                    "status": "completed",
                    "priority": "HIGH",
                    "files": "src/audio/AudioManager.cpp, src/audio/RingBuffer.h, src/audio/SFXSynthesizer.cpp, src/core/Engine.cpp",
                    "notes": "COMPLETED 2025-12-14. ROOT CAUSE: AudioCallback ran in separate SDL thread and called sfxSynthesizer->RenderSamples() directly, blocking the main thread. SOLUTION: Implemented lock-free ring buffer (SPSC) with atomic operations. Main thread generates audio and writes to buffer (GenerateAudio()), audio callback thread reads from buffer. No locks! Result: Audio works without any input lag. Ring buffer is 8192 samples (~92ms latency at 44.1kHz stereo). BONUS: Implemented basic SFX system with 8 channels, 4 waveforms (sine, square, triangle, noise), soft limiter to prevent clipping. sfx() function fully working!"
                },
                {
                    "id": "1.1.7",
                    "description": "Fix critical input lag - severe delay between button press and game response.",
                    "status": "completed",
                    "priority": "CRITICAL",
                    "files": "src/core/Engine.cpp",
                    "notes": "COMPLETED 2025-12-14 after 4+ hours debugging. ROOT CAUSE: Fixed timestep loop calling _update() multiple times caused btnp() state confusion. SOLUTION: Simplified to basic 60fps loop like PICO-8 - one _update() per frame with sleep to cap FPS. Input now perfect! Game loop: beginNewFrame() → SDL_PollEvent() → _update() → _draw() → sleep(16ms). Removed complex lag accumulation."
                },
                {
                    "id": "1.1.4",
                    "description": "Connect Map API to engine - mget/mset/map functions are stubs.",
                    "status": "completed",
                    "priority": "MEDIUM",
                    "files": "src/scripting/ScriptingManager.cpp, src/core/Engine.h, src/core/Engine.cpp, docs/MAP_FORMAT.md",
                    "notes": "COMPLETED 2025-12-13. Added Map instance to Engine, connected all 3 functions (map/mget/mset). Layer system fully documented with parallax examples."
                },
                {
                    "id": "1.1.5",
                    "description": "Add proper PNG loading using stb_image - currently using SDL_LoadBMP fallback.",
                    "status": "completed",
                    "priority": "MEDIUM",
                    "files": "src/rendering/SpriteSheet.cpp, external/stb/stb_image.h, CMakeLists.txt",
                    "notes": "COMPLETED 2025-12-13. Auto-downloads stb_image.h from GitHub. Supports PNG, JPG, BMP, TGA, GIF, PSD, HDR formats."
                },
                {
                    "id": "1.1.6",
                    "description": "Improve error messages - make runtime errors more helpful for developers.",
                    "status": "completed",
                    "priority": "LOW",
                    "files": "src/scripting/ScriptingManager.cpp, src/cartridge/CartridgeLoader.cpp",
                    "notes": "COMPLETED 2025-12-13. Added: Lua stack traces, file-not-found suggestions, formatted error blocks, helpful tips for common issues."
                },
                {
                    "id": "1.1.7",
                    "description": "Add unit tests - basic test coverage for core systems.",
                    "status": "pending",
                    "priority": "LOW",
                    "files": "tests/",
                    "notes": "Use Google Test or Catch2. Test AestheticLayer, InputManager, basic APIs."
                }
            ]
        },
        {
            "phase": 1.5,
            "title": "Quality of Life & Tools (Lite)",
            "description": "Essential development tools without full IDE. Lightweight improvements for v1.5.",
            "priority": "MEDIUM",
            "estimatedTime": "2-3 weeks",
            "tasks": [
                {
                    "id": "1.5.1",
                    "description": "Implement Hot Reload - auto-reload cartridge when main.lua changes.",
                    "status": "completed",
                    "priority": "HIGH",
                    "files": "src/core/HotReload.h, src/core/HotReload.cpp, src/core/Engine.cpp, CMakeLists.txt",
                    "notes": "COMPLETED 2025-12-13. File watching with std::filesystem, auto-detects changes every frame, instant reload. Massive productivity boost!"
                },
                {
                    "id": "1.5.2",
                    "description": "Add simple Debug Console overlay - show print() output and FPS on screen.",
                    "status": "completed",
                    "priority": "HIGH",
                    "files": "src/ui/DebugConsole.h, src/ui/DebugConsole.cpp, src/core/Engine.cpp, src/scripting/ScriptingManager.cpp, CMakeLists.txt",
                    "notes": "COMPLETED 2025-12-13. Toggle with F1. Shows last 10 print() calls, FPS counter, no ImGui needed. Perfect for debugging without console!"
                },
                {
                    "id": "1.5.3",
                    "description": "Implement Screenshot capture - F12 to save PNG.",
                    "status": "completed",
                    "priority": "MEDIUM",
                    "files": "src/capture/Screenshot.h, src/capture/Screenshot.cpp, src/rendering/AestheticLayer.cpp, src/core/Engine.cpp, CMakeLists.txt",
                    "notes": "COMPLETED 2025-12-13. F12 captures screenshot to screenshots/ folder. Auto-downloads stb_image_write.h. Timestamped filenames. Perfect for sharing game moments!"
                },
                {
                    "id": "1.5.4",
                    "description": "Add GIF recording - Ctrl+F12 for 5-second GIF.",
                    "status": "completed",
                    "priority": "LOW",
                    "files": "src/capture/GifRecorder.h, src/capture/GifRecorder.cpp, src/core/Engine.cpp, src/rendering/AestheticLayer.cpp, CMakeLists.txt",
                    "notes": "COMPLETED 2025-12-13. msf_gif.h integrated. Ctrl+F12 records 5s @ 60fps. Saves to screenshots/recording_*.gif. ARGB→RGBA conversion fixed for proper colors. Perfect for sharing gameplay!"
                },
                {
                    "id": "1.5.5",
                    "description": "Create cartridge template system - 'ulics new [name]' command.",
                    "status": "completed",
                    "priority": "LOW",
                    "files": "tools/new-cartridge.ps1, ulics.ps1",
                    "notes": "COMPLETED 2025-12-13. PowerShell script creates full cartridge structure (config.json, main.lua, README.md). 4 templates: Simple, Platformer, TopDown, Puzzle. Usage: .\\tools\\new-cartridge.ps1 -Name 'game' -Template Platformer. Massive productivity boost for developers!"
                }
            ]
        },
        {
            "phase": 2.0,
            "title": "Integrated Development Environment (Custom UI)",
            "description": "Complete IDE with custom pixel-perfect UI. Transform ULICS into a self-contained development environment like PICO-8/TIC-80 using native rendering.",
            "priority": "HIGH",
            "estimatedTime": "3-4 weeks",
            "philosophy": "NO external UI libraries (ImGui, Nuklear). 100% custom retro UI using AestheticLayer primitives for authentic fantasy console feel.",
            "tasks": [
                {
                    "id": "2.0.1",
                    "description": "Create Custom UI System - Base widgets using AestheticLayer primitives.",
                    "status": "pending",
                    "priority": "CRITICAL",
                    "files": "src/ui/UISystem.h, src/ui/UISystem.cpp, src/ui/Widget.h",
                    "estimatedTime": "2-3 hours",
                    "notes": "Create base UI system with: Panel rendering, Text wrapping, Input handling, Focus management. All rendered with rectfill/print/pset. This is the foundation for ALL editors. 100% pixel-perfect retro style like PICO-8/TIC-80."
                },
                {
                    "id": "2.0.2",
                    "description": "Code Editor Part 1 - Basic text editing and display (CORE FEATURE!).",
                    "status": "pending",
                    "priority": "CRITICAL",
                    "files": "src/ui/CodeEditor.h, src/ui/CodeEditor.cpp",
                    "estimatedTime": "3-4 hours",
                    "notes": "Multi-line text buffer, Cursor movement (arrows, home/end, page up/down), Text insertion/deletion, Line numbers, Vertical scrolling, Status bar (line:col). Load from main.lua on start. THIS IS WHAT MAKES ULICS A TRUE FANTASY CONSOLE!"
                },
                {
                    "id": "2.0.3",
                    "description": "Code Editor Part 2 - Syntax highlighting for Lua.",
                    "status": "pending",
                    "priority": "CRITICAL",
                    "files": "src/ui/CodeEditor.cpp, src/ui/LuaSyntax.h",
                    "estimatedTime": "2-3 hours",
                    "notes": "Simple token-based highlighting: Keywords (function, if, for, etc) = cyan, Strings = pink, Numbers = orange, Comments = gray, Default = white. Use simple regex or string matching. Good enough for fantasy console!"
                },
                {
                    "id": "2.0.4",
                    "description": "Code Editor Part 3 - Save/Run integration and hotkeys.",
                    "status": "pending",
                    "priority": "CRITICAL",
                    "files": "src/ui/CodeEditor.cpp, src/core/Engine.cpp",
                    "estimatedTime": "1-2 hours",
                    "notes": "Ctrl+S to save main.lua, Ctrl+R to run/reload cartridge, Ctrl+C/V for copy/paste, Tab key for indentation, Escape to toggle game view. Make it feel like PICO-8!"
                },
                {
                    "id": "2.0.5",
                    "description": "Mode Switcher - Toggle between Code/Sprite/Map/Game views.",
                    "status": "pending",
                    "priority": "HIGH",
                    "files": "src/core/Engine.cpp, src/ui/ModeManager.h",
                    "estimatedTime": "1-2 hours",
                    "notes": "F1=Code, F2=Sprites, F3=Map, F4=SFX, Escape=Game. Like PICO-8 function keys. Engine modes: CODE_EDITOR, SPRITE_EDITOR, MAP_EDITOR, GAME_RUNNING."
                },
                {
                    "id": "2.0.6",
                    "description": "Sprite Editor - Pixel art editor with custom UI.",
                    "status": "pending",
                    "priority": "HIGH",
                    "files": "src/ui/SpriteEditor.h, src/ui/SpriteEditor.cpp",
                    "estimatedTime": "4-5 hours",
                    "notes": "Canvas with zoom grid (8x8), 16-color palette picker (2x8 grid), Tools: pencil, fill, line, rectangle, picker. Save to spritesheet.png. Use rectfill/pset for all UI. Retro pixel-perfect interface."
                },
                {
                    "id": "2.0.7",
                    "description": "Map Editor - Tile map editor with layer support.",
                    "status": "pending",
                    "priority": "HIGH",
                    "files": "src/ui/MapEditor.h, src/ui/MapEditor.cpp",
                    "estimatedTime": "4-5 hours",
                    "notes": "128x64 tile grid, up to 8 layers, tile picker from spritesheet, layer selector (buttons 0-7), fill tool, pencil tool. Custom UI with rectfill/print. Save to map data (JSON or binary)."
                },
                {
                    "id": "2.0.8",
                    "description": "SFX Editor - Waveform designer with custom UI.",
                    "status": "pending",
                    "priority": "MEDIUM",
                    "files": "src/ui/SFXEditor.h, src/ui/SFXEditor.cpp",
                    "estimatedTime": "3-4 hours",
                    "notes": "Waveform type buttons (sine/square/triangle/noise), ADSR sliders (rendered with rectfill), frequency input, duration input, preview button. All custom UI. Save to JSON."
                },
                {
                    "id": "2.0.9",
                    "description": "Music Tracker - Pattern-based music editor.",
                    "status": "pending",
                    "priority": "MEDIUM",
                    "files": "src/ui/MusicTracker.h, src/ui/MusicTracker.cpp",
                    "estimatedTime": "4-5 hours",
                    "notes": "4-8 channels, pattern grid (rows=notes, cols=channels), note input (C-4, D#5, etc), tempo controls, pattern sequencer. PICO-8 style tracker. Custom UI with grid rendering."
                },
                {
                    "id": "2.0.10",
                    "description": "Palette Editor - Customize color palette.",
                    "status": "pending",
                    "priority": "MEDIUM",
                    "files": "src/ui/PaletteEditor.h, src/ui/PaletteEditor.cpp",
                    "estimatedTime": "2-3 hours",
                    "notes": "16-color grid, RGB sliders for selected color, preset buttons (PICO-8, TIC-80, DB16), live preview. Custom UI. Save to config.json."
                },
                {
                    "id": "2.0.11",
                    "description": "Command Line / REPL - Interactive Lua console.",
                    "status": "pending",
                    "priority": "LOW",
                    "files": "src/ui/Console.h, src/ui/Console.cpp",
                    "estimatedTime": "2-3 hours",
                    "notes": "Type Lua commands, execute on Enter, show results, command history (up/down arrows). PICO-8 has this for quick testing. Toggle with backtick key."
                }
            ]
        },
        {
            "phase": 3.0,
            "title": "Advanced Features & Distribution",
            "description": "Advanced features for power users and cartridge distribution system.",
            "priority": "LOW",
            "estimatedTime": "4-6 weeks",
            "tasks": [
                {
                    "id": "3.0.1",
                    "description": "Implement Performance Profiler - real-time CPU monitoring.",
                    "status": "pending",
                    "priority": "LOW",
                    "files": "src/ui/Profiler.h, src/ui/Profiler.cpp",
                    "notes": "CPU time graphs, _update()/_draw() execution time, memory usage. Custom UI rendering."
                },
                {
                    "id": "3.0.2",
                    "description": "Add Save State System - F5/F9 for quick save/load game state.",
                    "status": "pending",
                    "priority": "MEDIUM",
                    "files": "src/core/SaveState.h, src/core/SaveState.cpp",
                    "notes": "Serialize Lua globals to file. Useful for testing specific scenarios."
                },
                {
                    "id": "3.0.3",
                    "description": "Create Keybinding Editor - remap controls UI.",
                    "status": "pending",
                    "priority": "LOW",
                    "files": "src/ui/KeybindingEditor.h, src/ui/KeybindingEditor.cpp",
                    "notes": "Visual button mapper, remap any button to any key/gamepad button, save to user prefs."
                },
                {
                    "id": "3.0.4",
                    "description": "Add In-Game Help Overlay - API quick reference with search.",
                    "status": "pending",
                    "priority": "LOW",
                    "files": "src/ui/HelpOverlay.h, src/ui/HelpOverlay.cpp",
                    "notes": "List all 40 API functions, search by name, quick examples, copy to clipboard."
                },
                {
                    "id": "3.0.5",
                    "description": "Implement Export/Publish System - bundle as standalone .exe or WASM.",
                    "status": "pending",
                    "priority": "LOW",
                    "files": "src/export/Exporter.h, src/export/Exporter.cpp",
                    "notes": "Windows .exe export, optional WASM for web, embed all assets, remove dev tools."
                }
            ]
        },
        {
            "phase": 4.0,
            "title": "Advanced Features",
            "description": "Advanced fantasy console features beyond PICO-8/TIC-80.",
            "priority": "FUTURE",
            "tasks": [
                {
                    "id": "4.0.1",
                    "description": "Add sprite animation helpers - automatic frame cycling.",
                    "status": "pending",
                    "priority": "MEDIUM",
                    "files": "src/rendering/SpriteAnimator.h"
                },
                {
                    "id": "4.0.2",
                    "description": "Implement particle system - simple but powerful particle effects.",
                    "status": "pending",
                    "priority": "MEDIUM",
                    "files": "src/rendering/ParticleSystem.h"
                },
                {
                    "id": "4.0.3",
                    "description": "Add tweening library - smooth interpolation for animations.",
                    "status": "pending",
                    "priority": "LOW",
                    "files": "src/utils/Tween.h"
                },
                {
                    "id": "4.0.4",
                    "description": "Implement coroutines for Lua - easier async game logic.",
                    "status": "pending",
                    "priority": "LOW",
                    "files": "src/scripting/Coroutines.cpp"
                },
                {
                    "id": "4.0.5",
                    "description": "Add basic physics engine - box2d integration for physics games.",
                    "status": "pending",
                    "priority": "LOW",
                    "files": "src/physics/"
                },
                {
                    "id": "4.0.6",
                    "description": "Implement networking - local multiplayer and simple online.",
                    "status": "pending",
                    "priority": "FUTURE",
                    "files": "src/network/"
                }
            ]
        }
    ],
    "roadmap": {
        "v1.1": {
            "release": "2025-12-20",
            "focus": "Bug Fixes",
            "tasks": "1.1.1 - 1.1.7"
        },
        "v1.5": {
            "release": "2026-01",
            "focus": "Developer Tools (Lite)",
            "tasks": "1.5.1 - 1.5.5"
        },
        "v2.0": {
            "release": "2026-03",
            "focus": "Full IDE",
            "tasks": "2.0.1 - 2.0.14"
        },
        "v3.0": {
            "release": "TBD",
            "focus": "Advanced Features",
            "tasks": "3.0.1+"
        }
    },
    "notes": [
        "v1.0.0 completed on 2025-12-13 with 68/88 tasks",
        "Core runtime is 100% functional",
        "Focus on fixing rendering bugs for v1.1",
        "IDE tools are optional - v1.x is usable without them",
        "Follow semantic versioning: MAJOR.MINOR.PATCH"
    ]
}