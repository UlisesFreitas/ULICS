{
  "projectName": "ULICS Fantasy Console",
  "description": "Development plan for a high-performance fantasy console with C++/SDL, separating logic and aesthetics.",
  "file_structure": [
    "U:/ULICS/",
    "├── .gitignore",
    "├── build.ps1",
    "├── CMakeLists.txt",
    "├── plan-ulics.json",
    "├── src/",
    "│   ├── core/",
    "│   │   ├── Engine.cpp",
    "│   │   └── Engine.h",
    "│   ├── demos/",
    "│   │   ├── DemoGame.cpp",
    "│   │   └── DemoGame.h",
    "│   ├── game/",
    "│   │   └── Game.h",
    "│   ├── rendering/",
    "│   │   ├── AestheticLayer.cpp",
    "│   │   └── AestheticLayer.h",
    "│   └── main.cpp",
    "└── (build/, sdl/)"
  ],
  "phases": [
    {
      "phase": 0,
      "title": "Build Automation and Environment",
      "description": "Establish a robust and automated development environment that manages dependencies, compilation, and project cleanup.",
      "tasks": [
        {
          "id": "0.1",
          "description": "Create a build script (build.ps1) that automates the entire process.",
          "status": "completed",
          "files": "build.ps1"
        },
        {
          "id": "0.2",
          "description": "The script must clean the build directory ('build') before each run to ensure a clean build.",
          "status": "completed",
          "files": "build.ps1"
        },
        {
          "id": "0.3",
          "description": "The script must terminate any running application instance ('UliCS.exe') before compiling.",
          "status": "completed",
          "files": "build.ps1"
        },
        {
          "id": "0.4",
          "description": "Generate a build log ('build_log.txt') with the complete process output.",
          "status": "completed",
          "files": "build.ps1"
        },
        {
            "id": "0.5",
            "description": "Automate dependency fetching and compilation (clone SDL2 from the repository if it doesn't exist).",
            "status": "completed",
            "files": "build.ps1, .gitignore"
        }
      ]
    },
    {
      "phase": 1,
      "title": "Initial Setup and Project Baseline",
      "description": "Establish the project structure, build system, and basic application window. The goal is to have a functional 'Hello World' that demonstrates the environment is correctly configured.",
      "libraries": [
        {
          "name": "SDL2",
          "purpose": "Main library for window management, 2D rendering, and input events."
        }
      ],
      "tasks": [
        {
          "id": "1.1",
          "description": "Define and create the project's directory structure (src, build, cartridges, assets).",
          "status": "completed",
          "files": "src/"
        },
        {
          "id": "1.2",
          "description": "Configure CMake to compile the project and link SDL2 statically.",
          "status": "completed",
          "files": "CMakeLists.txt"
        },
        {
          "id": "1.3",
          "description": "Create a basic application that initializes SDL, opens a window, and demonstrates that static linking works.",
          "status": "completed",
          "files": "src/main.cpp"
        },
        {
          "id": "1.4",
          "description": "Create the main 'Engine' class to encapsulate SDL initialization, the window, and the main loop.",
          "status": "completed",
          "files": "src/Engine.h, src/Engine.cpp, src/main.cpp"
        }
      ]
    },
    {
      "phase": 2,
      "title": "Engine Architecture (Dual Layer)",
      "description": "Implement the core of the dual-layer architecture: the aesthetic rendering layer and the game logic layer.",
      "libraries": [
        {
          "name": "SDL2",
          "purpose": "Continues to be the foundation for rendering."
        }
      ],
      "tasks": [
        {
          "id": "2.1",
          "description": "Develop the 'Aesthetic Layer': a class that manages a low-resolution framebuffer (e.g., 256x256) and a base 16-color palette.",
          "status": "completed",
          "files": "src/AestheticLayer.h, src/AestheticLayer.cpp, src/Engine.h, src/Engine.cpp"
        },
        {
          "id": "2.2",
          "description": "Implement the basic drawing API in the Aesthetic Layer (PSET, LINE, RECT) that operates on the framebuffer.",
          "status": "completed",
          "files": "src/AestheticLayer.h, src/AestheticLayer.cpp, src/Engine.cpp"
        },
        {
          "id": "2.3",
          "description": "Create a mechanism to scale and render the Aesthetic Layer's framebuffer to the main SDL window.",
          "status": "completed",
          "files": "src/Engine.cpp, src/AestheticLayer.cpp"
        },
        {
          "id": "2.4",
          "description": "Develop the 'Logic Layer' which will contain the _update() and _draw() functions and will call the Aesthetic Layer's API.",
          "status": "completed",
          "files": "src/core/, src/demos/, src/game/, src/rendering/, CMakeLists.txt, todos los archivos .h/.cpp"
        },
        {
          "id": "2.5",
          "description": "Separate the update logic (_update) from the drawing logic (_draw) in the Logic Layer for a decoupled game loop.",
          "status": "completed",
          "files": "src/game/Game.h, src/demos/DemoGame.h, src/demos/DemoGame.cpp, src/core/Engine.cpp"
        },
        {
          "id": "2.6",
          "description": "Implement a fixed timestep game loop to decouple logic from rendering speed.",
          "status": "completed",
          "files": "src/core/Engine.h, src/core/Engine.cpp"
        }
      ]
    },
    {
      "phase": 3,
      "title": "Scripting Integration (Lua C API)",
      "description": "Incorporate the **Lua** scripting engine using its native C API for maximum control. The game logic will be written by the end-user, and we will connect the engine's API to Lua.",
      "libraries": [
        {
          "name": "Lua (C API)",
          "purpose": "The main scripting engine. The native C API (or a lightweight C++ wrapper) will be used for binding."
        }
      ],
      "tasks": [
        {
          "id": "3.1",
          "description": "Integrate the **Lua** static library into the project (compile from source or use vcpkg) via CMake.",
          "status": "completed"
        },
        {
          "id": "3.2",
          "description": "Create a 'ScriptingManager' class to manage the Lua state (`lua_State`), load, and execute scripts.",
          "status": "completed"
        },
        {
          "id": "3.3",
          "description": "Expose (bind) the Aesthetic Layer's API functions (PSET, LINE, etc.) to the Lua environment using the **Lua C API**.",
          "status": "completed"
        },
        {
          "id": "3.4",
          "description": "Modify the engine's main loop to call the main functions (_update(), _draw()) of the loaded Lua script.",
          "status": "completed",
          "notes": "Implemented using an embedded script for a self-contained executable."
        },
        {
          "id": "3.5",
          "description": "Expand the core drawing API in Lua: `circ`, `circfill`, and `pget`.",
          "status": "completed"
        },
        {
          "id": "3.6",
          "description": "Implement a basic `InputManager` to track keyboard state.",
          "status": "completed"
        },
        {
          "id": "3.7",
          "description": "Expose input functions to Lua: `btn(i)` and `btnp(i)`.",
          "status": "completed"
        },
        {
          "id": "3.8",
          "description": "Embed a default bitmap font and expose a `print(str, x, y, color)` function to Lua.",
          "status": "completed"
        },
        {
          "id": "3.9",
          "description": "Improve runtime error handling to display Lua errors on-screen instead of only in the console.",
          "status": "completed",
          "notes": "Engine now enters an error state and renders the Lua error message directly to the screen."
        },
        {
          "id": "3.10",
          "description": "Expose a `time()` function to Lua that returns the elapsed time since engine start.",
          "status": "completed",
          "notes": "Refactored ScriptingManager to hold a pointer to the Engine for easier access to subsystems."
        },
        {
          "id": "3.11",
          "description": "Expose convenience math functions (`sin`, `cos`, `rnd`, `flr`, etc.) to the global Lua namespace.",
          "status": "completed",
          "notes": "Added sin, cos, atan2, sqrt, abs, flr, ceil, and rnd. Adopted PICO-8 angle conventions."
        },
        {
          "id": "3.12",
          "description": "Implement and expose a `camera(x, y)` function to offset all subsequent drawing operations.",
          "status": "completed",
          "notes": "Added camera(x, y) offset to AestheticLayer and exposed it to Lua. All drawing primitives now respect the camera."
        },
        {
          "id": "3.13",
          "description": "Implement and expose a `tcolor(color_id)` function that sets the current transparent color index.",
          "status": "completed",
          "notes": "Added optional transparency to AestheticLayer, controlled via tcolor(c) in Lua. Refactored drawing primitives to respect transparency."
        }
      ]
    },
    {
      "phase": 4,
      "title": "Cartridge System and Modularity (Base UI Prepared)",
      "description": "Define and develop the 'cartridge' system for loading games and the console's modular configuration. The engine's state management is prepared for a simple UI.",
      "management": "The application will be managed via 'cartridges'. A cartridge will be a directory containing a 'main.lua' file for code and a 'config.json' for metadata and modular configuration. Optionally, it can include an 'assets' directory.",
      "libraries": [
        {
          "name": "nlohmann/json",
          "purpose": "A modern C++ library to easily parse the 'config.json' file of each cartridge."
        }
      ],
      "tasks": [
        {
          "id": "4.1",
          "description": "Design the 'cartridge' structure and the 'config.json' file format (will include 'memory_limit_mb', 'lua_code_limit_lines', 'palette_size').",
          "status": "pending"
        },
        {
          "id": "4.2",
          "description": "Integrate the 'nlohmann/json' library for configuration parsing.",
          "status": "pending"
        },
        {
          "id": "4.3",
          "description": "Implement a 'CartridgeLoader' class that reads a cartridge directory, parses 'config.json', and loads it into the engine.",
          "status": "pending"
        },
        {
          "id": "4.4",
          "description": "Adapt the engine to use the cartridge's configuration: dynamically adjust the palette size in the Aesthetic Layer (16, 32, 64, 128).",
          "status": "pending"
        },
        {
          "id": "4.5",
          "description": "Implement limit-checking logic (e.g., Lua code lines) in the 'ScriptingManager' as an informative 'soft' constraint.",
          "status": "pending"
        },
        {
          "id": "4.6",
          "description": "Implement the **execution state logic** in the `Engine` (e.g., using an `enum` for `STATE_BOOT`, `STATE_MENU`, `STATE_GAME`, `STATE_ERROR`).",
          "status": "pending"
        },
        {
          "id": "4.7",
          "description": "Create the **`cartridges/` directory** and implement the scanning logic in the `CartridgeLoader` to list all available cartuchos.",
          "status": "pending"
        },
        {
          "id": "4.8",
          "description": "Modify the `Engine` to, if no cartridge is specified, automatically enter `STATE_MENU` and launch an **internal system script** (e.g., `system/menu.lua`) to render the initial UI.",
          "status": "pending"
        }
      ]
    },
    {
      "phase": 5,
      "title": "API Expansion and Features",
      "description": "Add essential features to a fantasy console, such as advanced user input, audio, and a richer drawing API.",
      "libraries": [
        {
          "name": "SDL2_mixer",
          "purpose": "To manage audio and music playback."
        },
        {
          "name": "SDL2_image",
          "purpose": "To load sprites from image files (PNG)."
        }
      ],
      "tasks": [
        {
          "id": "5.1",
          "description": "Create an 'InputManager' to handle keyboard and gamepad, and expose a simple API to Lua (btn(), btnp()).",
          "status": "pending"
        },
        {
          "id": "5.2",
          "description": "Integrate SDL2_mixer and create an 'AudioManager' with functions to play sounds and music (sfx(), music()), exposed to Lua.",
          "status": "pending"
        },
        {
          "id": "5.3",
          "description": "Expand the drawing API in the Aesthetic Layer with SPRITE, CIRCLE, and other primitives. Expose to Lua.",
          "status": "pending"
        },
        {
          "id": "5.4",
          "description": "Implement a 'SpriteSheet' system that can be loaded from the cartridge's assets.",
          "status": "pending"
        },
        {
          "id": "5.5",
          "description": "Implement a function `mousetoggle(enabled)` to activate/deactivate the mouse cursor and expose the functions `mousex()`, `mousey()` to Lua for basic UI interaction.",
          "status": "pending"
        }
      ]
    },
    {
      "phase": 6,
      "title": "Finalization, Documentation, and Examples",
      "description": "Create a complete demo cartridge, document the API for end-users, and polish the project for its initial release.",
      "libraries": [],
      "tasks": [
        {
          "id": "6.1",
          "description": "Develop a demo cartridge (e.g., a simple game like Pong or a basic platformer) that uses all API features.",
          "status": "pending"
        },
        {
          "id": "6.2",
          "description": "Write comprehensive API documentation in Markdown format, explaining each Lua function, its parameters, and its behavior.",
          "status": "pending"
        },
        {
          "id": "6.3",
          "description": "Perform a general code review, refactor, and optimize where necessary before considering it v1.0.",
          "status": "pending"
        }
      ]
    }
  ]
}